{% extends 'image_app/base.html' %}
{% load static %}

{% block title %}Compress Image to 100KB Online Free | JPEG to 100KB Compressor | Image Compressor 100KB{% endblock %}
{% block description %}Compress image to 100KB, compress JPEG to 100KB, and resize image to 100KB online free. Professional image compressor to 100KB for high-quality photos, portfolios, and premium uploads.{% endblock %}
{% block keywords %}compress image to 100kb, compress jpeg to 100kb, image compressor to 100kb, resize image to 100kb, photo compressor 100kb, reduce image to 100kb, 100kb image compressor{% endblock %}
{% block canonical %}https://resizeimages.tools/compress-to-100kb/{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary: #7C3AED;
        --primary-hover: #6D28D9;
        --primary-light: #F5F3FF;
        --secondary: #2563EB;
        --secondary-hover: #1D4ED8;
        --accent: #DC2626;
        --background: #F9FAFB;
        --surface: #FFFFFF;
        --text-primary: #111827;
        --text-secondary: #6B7280;
        --border: #E5E7EB;
        --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
        --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
        --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.15);
        --radius-sm: 6px;
        --radius-md: 10px;
        --radius-lg: 14px;
        --radius-xl: 18px;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        background: linear-gradient(135deg, #F9FAFB 0%, #F3F4F6 100%);
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
    }

    .hero-section {
        background: linear-gradient(135deg, #2563EB 0%, #3B82F6 50%, #60A5FA 100%);
        color: white;
        padding: 3rem 1.5rem 2.5rem;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    .hero-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at 30% 50%, rgba(255,255,255,0.1) 0%, transparent 50%);
        pointer-events: none;
    }

    .hero-content {
        position: relative;
        z-index: 1;
        max-width: 750px;
        margin: 0 auto;
    }

    .hero-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-size: 0.875rem;
        margin-bottom: 1.25rem;
        border: 1px solid rgba(255, 255, 255, 0.3);
        font-weight: 600;
    }

    .hero-title {
        font-size: clamp(2rem, 5vw, 2.75rem);
        font-weight: 900;
        margin-bottom: 0.75rem;
        letter-spacing: -0.03em;
        line-height: 1.1;
    }

    .hero-subtitle {
        font-size: clamp(1rem, 2.5vw, 1.125rem);
        opacity: 0.95;
        line-height: 1.6;
        font-weight: 400;
        max-width: 600px;
        margin: 0 auto;
    }

    .main-container {
        max-width: 850px;
        margin: -2rem auto 3rem;
        padding: 0 1.5rem;
        position: relative;
        z-index: 10;
    }

    .upload-card {
        background: var(--surface);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-xl);
        overflow: hidden;
        border: 1px solid var(--border);
    }

    .card-section {
        padding: 2rem;
    }

    .section-title {
        font-size: 1.125rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 1.25rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .section-icon {
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, var(--secondary) 0%, #3B82F6 100%);
        color: white;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.875rem;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    .upload-zone {
        background: linear-gradient(135deg, #FAFAFB 0%, #F3F4F6 100%);
        border: 2px dashed var(--border);
        border-radius: var(--radius-lg);
        padding: 2.5rem 2rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
    }

    .upload-zone:hover,
    .upload-zone.drag-active {
        border-color: var(--secondary);
        background: linear-gradient(135deg, #EFF6FF 0%, #DBEAFE 100%);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(37, 99, 235, 0.15);
    }

    .upload-icon {
        width: 64px;
        height: 64px;
        margin: 0 auto 1.25rem;
        background: linear-gradient(135deg, var(--secondary) 0%, #3B82F6 100%);
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.75rem;
        box-shadow: 0 8px 24px rgba(37, 99, 235, 0.4);
        transition: all 0.3s ease;
    }

    .upload-zone:hover .upload-icon {
        transform: scale(1.1) rotate(5deg);
    }

    .upload-title {
        font-size: 1.125rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }

    .upload-description {
        color: var(--text-secondary);
        font-size: 0.9375rem;
        margin-bottom: 1.25rem;
    }

    .file-input {
        display: none;
    }

    .upload-button {
        background: linear-gradient(135deg, var(--secondary) 0%, #3B82F6 100%);
        color: white;
        border: none;
        padding: 0.75rem 2rem;
        border-radius: var(--radius-md);
        font-size: 0.9375rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        pointer-events: none;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    .upload-specs {
        display: flex;
        justify-content: center;
        gap: 1.5rem;
        margin-top: 1.25rem;
        padding-top: 1.25rem;
        border-top: 1px solid var(--border);
        font-size: 0.875rem;
    }

    .spec-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--text-secondary);
        font-weight: 500;
    }

    .spec-icon {
        color: var(--secondary);
    }

    .preview-section {
        display: none;
        padding: 1.25rem;
        background: linear-gradient(to right, #EFF6FF 0%, #DBEAFE 100%);
        border-radius: var(--radius-lg);
        border: 1px solid #93C5FD;
        margin-top: 1rem;
    }

    .preview-section.active {
        display: block;
        animation: slideIn 0.4s ease;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .preview-container {
        display: flex;
        align-items: center;
        gap: 1.25rem;
    }

    .preview-thumbnail {
        width: 80px;
        height: 80px;
        border-radius: var(--radius-md);
        object-fit: cover;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border: 3px solid white;
    }

    .preview-details {
        flex: 1;
        min-width: 0;
    }

    .preview-filename {
        font-size: 0.9375rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.375rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .preview-meta {
        display: flex;
        gap: 1rem;
        font-size: 0.8125rem;
        color: var(--text-secondary);
        font-weight: 500;
    }

    .remove-button {
        background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
        color: white;
        border: none;
        width: 36px;
        height: 36px;
        border-radius: var(--radius-sm);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }

    .remove-button:hover {
        transform: scale(1.1);
    }

    .options-section {
        border-top: 1px solid var(--border);
        background: #FAFAFA;
    }

    .options-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }

    .option-card {
        background: white;
        border: 2px solid var(--border);
        border-radius: var(--radius-md);
        padding: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .option-card:hover {
        border-color: var(--secondary);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
    }

    .option-card.selected {
        border-color: var(--secondary);
        background: linear-gradient(135deg, #EFF6FF 0%, #DBEAFE 100%);
    }

    .option-radio {
        width: 20px;
        height: 20px;
        border: 2px solid var(--border);
        border-radius: 50%;
        position: relative;
        flex-shrink: 0;
        transition: all 0.3s ease;
    }

    .option-card.selected .option-radio {
        border-color: var(--secondary);
        background: var(--secondary);
    }

    .option-card.selected .option-radio::after {
        content: '✓';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 0.75rem;
        font-weight: 700;
    }

    .option-details {
        flex: 1;
    }

    .option-title {
        font-size: 0.9375rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.25rem;
    }

    .option-description {
        font-size: 0.8125rem;
        color: var(--text-secondary);
    }

    .compress-button {
        width: 100%;
        background: linear-gradient(135deg, var(--secondary) 0%, #1D4ED8 100%);
        color: white;
        border: none;
        padding: 1rem 2rem;
        border-radius: var(--radius-md);
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.625rem;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        margin-top: 1.5rem;
    }

    .compress-button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4);
    }

    .compress-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .loading-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.98);
        z-index: 9999;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(10px);
    }

    .loading-overlay.active {
        display: flex;
    }

    .loading-content {
        text-align: center;
        max-width: 320px;
    }

    .loading-spinner {
        width: 64px;
        height: 64px;
        margin: 0 auto 1.5rem;
        border: 5px solid #E5E7EB;
        border-top-color: var(--secondary);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    .loading-title {
        font-size: 1.25rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .loading-subtitle {
        font-size: 1rem;
        color: var(--text-secondary);
    }

    .download-page {
        display: none;
    }

    .download-page.active {
        display: block;
    }

    .download-container {
        max-width: 700px;
        margin: -2rem auto 3rem;
        padding: 0 1.5rem;
        position: relative;
        z-index: 10;
    }

    .download-card {
        background: var(--surface);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-xl);
        overflow: hidden;
        border: 1px solid var(--border);
    }

    .download-preview-section {
        padding: 2rem;
        text-align: center;
        background: linear-gradient(to bottom, #EFF6FF 0%, #DBEAFE 100%);
    }

    .download-image-wrapper {
        background: white;
        border-radius: var(--radius-lg);
        padding: 1.25rem;
        margin-bottom: 1.25rem;
        display: inline-block;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    }

    .download-thumbnail {
        max-width: 100%;
        max-height: 200px;
        border-radius: var(--radius-md);
        object-fit: contain;
    }

    .download-filename {
        font-size: 1.125rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        word-break: break-word;
    }

    .download-size-text {
        font-size: 0.9375rem;
        color: var(--text-secondary);
        margin-bottom: 1.25rem;
        font-weight: 500;
    }

    .stats-row {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    .stat-badge {
        background: white;
        padding: 1rem 1.25rem;
        border-radius: var(--radius-md);
        min-width: 110px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        border: 1px solid #93C5FD;
    }

    .stat-value {
        font-size: 1.25rem;
        font-weight: 800;
        color: var(--secondary);
        margin-bottom: 0.25rem;
    }

    .stat-label {
        font-size: 0.75rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        font-weight: 600;
        letter-spacing: 0.05em;
    }

    .download-actions {
        padding: 2rem;
    }

    .primary-download-btn {
        width: 100%;
        background: linear-gradient(135deg, var(--secondary) 0%, #3B82F6 100%);
        color: white;
        border: none;
        padding: 1rem;
        border-radius: var(--radius-md);
        font-size: 1.0625rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.625rem;
        margin-bottom: 1.25rem;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    .primary-download-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4);
    }

    .action-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.875rem;
        margin-bottom: 1.25rem;
    }

    .action-btn {
        padding: 0.75rem;
        border-radius: var(--radius-md);
        font-size: 0.875rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .btn-primary { background: linear-gradient(135deg, #7C3AED 0%, #A855F7 100%); color: white; }
    .btn-success { background: linear-gradient(135deg, #059669 0%, #10B981 100%); color: white; }
    .btn-warning { background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); color: white; }
    .btn-info { background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%); color: white; }

    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .privacy-card {
        background: linear-gradient(to right, #FEF3C7 0%, #FDE68A 100%);
        border: 1px solid #FCD34D;
        border-radius: var(--radius-md);
        padding: 1.25rem;
        display: flex;
        gap: 1rem;
        align-items: flex-start;
    }

    .privacy-icon {
        width: 36px;
        height: 36px;
        background: white;
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #F59E0B;
        flex-shrink: 0;
        box-shadow: 0 2px 8px rgba(245, 158, 11, 0.2);
    }

    .privacy-text {
        font-size: 0.875rem;
        color: #92400E;
        line-height: 1.6;
    }

    .content-wrapper {
        max-width: 1100px;
        margin: 3rem auto;
        padding: 0 1.5rem;
    }

    .content-section {
        background: white;
        border-radius: var(--radius-xl);
        padding: 3rem;
        margin-bottom: 2rem;
        box-shadow: var(--shadow-md);
        border: 1px solid var(--border);
    }

    .content-heading {
        font-size: 2rem;
        font-weight: 800;
        color: var(--text-primary);
        margin-bottom: 1.5rem;
        line-height: 1.3;
        position: relative;
        padding-bottom: 1rem;
    }

    .content-heading::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 70px;
        height: 4px;
        background: linear-gradient(to right, var(--secondary), #3B82F6);
        border-radius: 2px;
    }

    .content-subheading {
        font-size: 1.375rem;
        font-weight: 700;
        color: var(--text-primary);
        margin: 2rem 0 1.25rem;
    }

    .content-text {
        color: var(--text-secondary);
        font-size: 1.0625rem;
        line-height: 1.8;
        margin-bottom: 1.25rem;
    }

    .content-list {
        color: var(--text-secondary);
        font-size: 1.0625rem;
        line-height: 1.8;
        padding-left: 1.75rem;
        margin: 1.25rem 0;
    }

    .content-list li {
        margin-bottom: 1rem;
    }

    .content-list li::marker {
        color: var(--secondary);
        font-weight: 700;
    }

    .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 1.75rem;
        margin-top: 2rem;
    }

    .feature-card {
        background: linear-gradient(to bottom, #FFFFFF 0%, #FAFAFA 100%);
        border-radius: var(--radius-lg);
        padding: 2rem;
        border: 1px solid var(--border);
        transition: all 0.4s ease;
    }

    .feature-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
        border-color: rgba(37, 99, 235, 0.2);
    }

    .feature-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, var(--secondary) 0%, #3B82F6 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1.25rem;
        color: white;
        font-size: 1.25rem;
        box-shadow: 0 6px 16px rgba(37, 99, 235, 0.3);
    }

    .feature-title {
        font-size: 1.125rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.75rem;
    }

    .feature-description {
        color: var(--text-secondary);
        line-height: 1.7;
        font-size: 0.9375rem;
    }

    .comparison-table {
        width: 100%;
        border-collapse: collapse;
        margin: 2rem 0;
        background: white;
        border-radius: var(--radius-lg);
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .comparison-table th {
        background: linear-gradient(135deg, var(--secondary) 0%, #3B82F6 100%);
        color: white;
        padding: 1rem;
        text-align: left;
        font-weight: 700;
        font-size: 0.9375rem;
    }

    .comparison-table td {
        padding: 1rem;
        border-bottom: 1px solid var(--border);
        color: var(--text-secondary);
    }

    .comparison-table tr:last-child td {
        border-bottom: none;
    }

    .comparison-table tr:hover {
        background: #FAFAFA;
    }

    @media (max-width: 768px) {
        .hero-section {
            padding: 2.5rem 1rem 2rem;
        }

        .main-container,
        .download-container {
            margin-top: -1.5rem;
        }

        .card-section {
            padding: 1.5rem;
        }

        .upload-zone {
            padding: 2rem 1.25rem;
        }

        .options-grid {
            grid-template-columns: 1fr;
        }

        .action-grid {
            grid-template-columns: 1fr;
        }

        .content-section {
            padding: 2rem 1.5rem;
        }

        .features-grid {
            grid-template-columns: 1fr;
        }

        .preview-container {
            flex-direction: column;
            text-align: center;
        }

        .comparison-table {
            font-size: 0.875rem;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 0.75rem 0.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<form style="display: none;">
{% csrf_token %}
</form>

<div class="page-wrapper">
    <!-- Upload Page -->
    <div id="uploadPage">
        <section class="hero-section">
            <div class="hero-content">
                
                <h1 class="hero-title">Compress Images to 100KB</h1>
                <p class="hero-subtitle">
                    Premium image compression with superior quality retention - ideal for professional portfolios and high-quality uploads
                </p>
            </div>
        </section>

        <div class="main-container">
            <div class="upload-card">
                <div class="card-section">
                    <h2 class="section-title">
                        <span class="section-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </span>
                        Upload Your Image
                    </h2>

                    <div class="upload-zone" id="uploadZone">
                        <input type="file" id="fileInput" class="file-input" accept="image/*">
                        <label for="fileInput" style="cursor: pointer; width: 100%;">
                            <div class="upload-icon">
                                <i class="fas fa-image"></i>
                            </div>
                            <h3 class="upload-title">Drop image or click to browse</h3>
                            <p class="upload-description">
                                JPEG, PNG, WebP, HEIC supported (max 10MB)
                            </p>
                            <button type="button" class="upload-button" onclick="event.preventDefault();">
                                Select Image
                            </button>
                            <div class="upload-specs">
                                <div class="spec-item">
                                    <i class="fas fa-check-circle spec-icon"></i>
                                    <span>Premium Quality</span>
                                </div>
                                <div class="spec-item">
                                    <i class="fas fa-check-circle spec-icon"></i>
                                    <span>Instant Results</span>
                                </div>
                                <div class="spec-item">
                                    <i class="fas fa-check-circle spec-icon"></i>
                                    <span>100% Secure</span>
                                </div>
                            </div>
                        </label>
                    </div>

                    <div class="preview-section" id="previewSection">
                        <div class="preview-container">
                            <img id="previewThumb" class="preview-thumbnail" alt="Preview">
                            <div class="preview-details">
                                <div class="preview-filename" id="previewName"></div>
                                <div class="preview-meta">
                                    <span><i class="fas fa-file-alt"></i> <span id="previewSize"></span></span>
                                    <span><i class="fas fa-expand-alt"></i> <span id="previewDimensions"></span></span>
                                </div>
                            </div>
                            <button type="button" class="remove-button" onclick="clearFile()" title="Remove">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card-section options-section">
                    <h2 class="section-title">
                        <span class="section-icon">
                            <i class="fas fa-sliders-h"></i>
                        </span>
                        Quality Settings
                    </h2>

                    <div class="options-grid">
                        <div class="option-card selected" data-quality="premium" onclick="selectOption(this)">
                            <div class="option-radio"></div>
                            <div class="option-details">
                                <div class="option-title">Premium Quality</div>
                                <div class="option-description">Maximum visual clarity</div>
                            </div>
                        </div>
                        <div class="option-card" data-quality="balanced" onclick="selectOption(this)">
                            <div class="option-radio"></div>
                            <div class="option-details">
                                <div class="option-title">Balanced</div>
                                <div class="option-description">Optimal quality-size ratio</div>
                            </div>
                        </div>
                        <div class="option-card" data-quality="maximum" onclick="selectOption(this)">
                            <div class="option-radio"></div>
                            <div class="option-details">
                                <div class="option-title">Maximum Compression</div>
                                <div class="option-description">Prioritize file size</div>
                            </div>
                        </div>
                    </div>

                    <button type="button" class="compress-button" id="compressBtn" onclick="compressImage()" disabled>
                        <i class="fas fa-compress-alt"></i>
                        Compress to 100KB
                    </button>
                </div>
            </div>
        </div>

        <!-- Content Sections -->
        <div class="content-wrapper">
            <div class="content-section">
                <h2 class="content-heading">Why Choose 100KB Compression?</h2>
                <p class="content-text">
                    Compressing images to 100KB represents the sweet spot for professional photography and high-quality digital content. This file size offers significantly better image quality compared to smaller targets (20KB, 50KB) while remaining compact enough for fast uploads and efficient storage. At 100KB, images can maintain higher resolution, better color accuracy, and sharper details - essential for portfolios, professional profiles, and premium content platforms.
                </p>
                <p class="content-text">
                    Our intelligent compression algorithm analyzes each image's unique characteristics to optimize the balance between file size and visual quality. Unlike simple resizing that merely reduces dimensions, our compression process employs advanced techniques including adaptive quality adjustment, smart dimension scaling, and format-specific optimizations to ensure your 100KB image looks as professional as possible.
                </p>

                <h3 class="content-subheading">Advantages of 100KB File Size</h3>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-eye"></i>
                        </div>
                        <h3 class="feature-title">Superior Visual Quality</h3>
                        <p class="feature-description">
                            100KB allows for 800-1200px images with 75-90% quality retention, preserving fine details, textures, and color gradients effectively.
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-briefcase"></i>
                        </div>
                        <h3 class="feature-title">Professional Standards</h3>
                        <p class="feature-description">
                            Ideal for LinkedIn premium profiles, executive portfolios, creative agency submissions, and high-quality business applications.
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-rocket"></i>
                        </div>
                        <h3 class="feature-title">Fast Loading</h3>
                        <p class="feature-description">
                            Loads in under 2 seconds on 3G networks, providing instant visual feedback while maintaining professional appearance.
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-palette"></i>
                        </div>
                        <h3 class="feature-title">Color Preservation</h3>
                        <p class="feature-description">
                            Maintains rich color depth and accurate skin tones crucial for portrait photography and professional headshots.
                        </p>
                    </div>
                </div>
            </div>

            <div class="content-section">
                <h2 class="content-heading">Advanced Compression Technology</h2>
                <p class="content-text">
                    Our 100KB compression engine uses state-of-the-art algorithms that go far beyond basic image resizing. The system intelligently analyzes your image content and applies multiple optimization strategies to achieve precisely 100KB while maximizing perceived quality.
                </p>

                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-microscope"></i>
                        </div>
                        <h3 class="feature-title">1. Intelligent Analysis</h3>
                        <p class="feature-description">
                            Deep content analysis identifies important regions (faces, text, sharp edges) that deserve quality priority during compression.
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3 class="feature-title">2. Adaptive Scaling</h3>
                        <p class="feature-description">
                            Dynamically calculates optimal dimensions based on aspect ratio, original size, and target file size for best results.
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-balance-scale"></i>
                        </div>
                        <h3 class="feature-title">3. Quality Optimization</h3>
                        <p class="feature-description">
                            Binary search algorithm finds the perfect quality setting within 15-20 iterations, hitting 100KB target with 95%+ accuracy.
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-tools"></i>
                        </div>
                        <h3 class="feature-title">4. Format Refinement</h3>
                        <p class="feature-description">
                            Applies JPEG progressive encoding, chroma subsampling optimization, and metadata management for maximum efficiency.
                        </p>
                    </div>
                </div>
            </div>

            <div class="content-section">
                <h2 class="content-heading">100KB vs Other File Sizes: Comparison Guide</h2>
                
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>File Size</th>
                            <th>Best Use Cases</th>
                            <th>Quality Level</th>
                            <th>Typical Dimensions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>20KB</strong></td>
                            <td>Basic passport photos, form uploads, very strict limits</td>
                            <td>Moderate (60-75%)</td>
                            <td>300-500px</td>
                        </tr>
                        <tr>
                            <td><strong>50KB</strong></td>
                            <td>Job applications, resumes, standard profiles</td>
                            <td>Good (70-80%)</td>
                            <td>500-700px</td>
                        </tr>
                        <tr>
                            <td><strong>100KB ⭐</strong></td>
                            <td>Professional portfolios, premium profiles, quality matters</td>
                            <td>Excellent (75-90%)</td>
                            <td>800-1200px</td>
                        </tr>
                        <tr>
                            <td><strong>200KB+</strong></td>
                            <td>High-res photography, print materials, detailed images</td>
                            <td>Superior (85-95%)</td>
                            <td>1200-2000px</td>
                        </tr>
                    </tbody>
                </table>

                <p class="content-text">
                    <strong>When to choose 100KB:</strong> When visual quality is important but you need to stay under storage limits. Perfect for situations where first impressions matter - portfolio websites, creative industry applications, executive profiles, and premium membership platforms.
                </p>
                <p class="content-text">
                    <strong>When to choose smaller:</strong> When facing very strict file size requirements (government forms, legacy systems) or when speed is more critical than quality (bulk uploads, thumbnails).
                </p>
            </div>

            <div class="content-section">
                <h2 class="content-heading">Professional Use Cases for 100KB Images</h2>
                
                <h3 class="content-subheading">Creative & Design Industries</h3>
                <ul class="content-list">
                    <li><strong>Portfolio Websites:</strong> Showcase your work with gallery images that load quickly but maintain visual appeal - crucial for photography, graphic design, and illustration portfolios</li>
                    <li><strong>Behance & Dribbble:</strong> Optimize profile images and project thumbnails for these creative platforms where quality directly impacts professional perception</li>
                    <li><strong>Agency Submissions:</strong> Submit work samples to creative agencies, design firms, and advertising companies that require high-quality compressed files</li>
                    <li><strong>Client Presentations:</strong> Email-friendly images that showcase your work without massive file attachments or quality compromise</li>
                </ul>

                <h3 class="content-subheading">Corporate & Business</h3>
                <ul class="content-list">
                    <li><strong>Executive Profiles:</strong> LinkedIn Premium, company websites, and annual reports where professional image quality reflects organizational standards</li>
                    <li><strong>Corporate Training Materials:</strong> E-learning platforms and internal training systems that need quality images without storage bloat</li>
                    <li><strong>Marketing Assets:</strong> Email marketing campaigns, landing pages, and promotional materials requiring fast-loading visuals</li>
                    <li><strong>Investor Relations:</strong> Pitch decks, investor presentations, and stakeholder communications where professional polish matters</li>
                </ul>

                <h3 class="content-subheading">Education & Research</h3>
                <ul class="content-list">
                    <li><strong>Academic Conferences:</strong> Speaker profiles, presentation materials, and conference proceedings with quality image requirements</li>
                    <li><strong>Research Publications:</strong> Journal submissions, research portals, and academic databases needing optimized figures and author photos</li>
                    <li><strong>Online Courses:</strong> Instructor profiles on Udemy, Coursera, Skillshare requiring professional yet efficient image files</li>
                    <li><strong>Student Portfolios:</strong> Graduate school applications, scholarship submissions showcasing academic and creative work</li>
                </ul>

                <h3 class="content-subheading">E-commerce & Marketplaces</h3>
                <ul class="content-list">
                    <li><strong>Seller Profiles:</strong> Amazon, Etsy, eBay seller photos that build trust while meeting platform specifications</li>
                    <li><strong>Product Photography:</strong> Secondary product images, lifestyle shots, and detail views for e-commerce platforms</li>
                    <li><strong>Service Listings:</strong> Fiverr, Upwork, TaskRabbit profile images showcasing professional credibility</li>
                    <li><strong>Marketplace Catalogs:</strong> Multi-vendor platforms requiring consistent, quality image standards across sellers</li>
                </ul>

                <h3 class="content-subheading">Social Media & Content Creation</h3>
                <ul class="content-list">
                    <li><strong>Professional Social Media:</strong> Twitter/X verified profiles, YouTube channel art, Facebook business pages prioritizing quality</li>
                    <li><strong>Blog & Article Images:</strong> Featured images, author bios, and inline graphics for WordPress, Medium, and content platforms</li>
                    <li><strong>Podcast Artwork:</strong> Show artwork, episode covers, and host photos for podcast directories and streaming platforms</li>
                    <li><strong>Newsletter Headers:</strong> Email newsletter mastheads, author photos, and featured visuals in Substack, ConvertKit, Mailchimp</li>
                </ul>
            </div>

            <div class="content-section">
                <h2 class="content-heading">Optimization Tips for Best Results</h2>
                
                <h3 class="content-subheading">Preparing Your Image</h3>
                <ul class="content-list">
                    <li><strong>Start with Excellence:</strong> Begin with the highest quality source image possible - ideally RAW, TIFF, or uncompressed JPEG from a quality camera</li>
                    <li><strong>Optimal Lighting:</strong> Well-exposed images with proper lighting compress significantly better than underexposed or overexposed photos</li>
                    <li><strong>Sharp Focus:</strong> Ensure your image is properly focused before compression - soft/blurry images become more noticeable when compressed</li>
                    <li><strong>Clean Background:</strong> Solid or simple backgrounds compress more efficiently than busy, detailed, or patterned backgrounds</li>
                    <li><strong>Correct Orientation:</strong> While our tool auto-rotates, ensure your image is properly oriented to avoid unnecessary processing</li>
                </ul>

                <h3 class="content-subheading">Quality Mode Selection Guide</h3>
                <p class="content-text">
                    <strong>Premium Quality Mode (Recommended):</strong> Optimizes for maximum visual fidelity by maintaining larger dimensions (900-1200px) and higher quality settings (80-90%). Best for professional photography, portfolios, and situations where image quality is paramount. The algorithm carefully balances dimension and quality to achieve 100KB while preserving fine details, smooth gradients, and accurate colors.
                </p>
                <p class="content-text">
                    <strong>Balanced Mode:</strong> Our versatile middle-ground option that provides excellent quality (75-85%) at medium dimensions (700-900px). Suitable for most professional use cases including business profiles, team photos, and general professional imagery. This mode equally prioritizes visual quality and precise file size targeting.
                </p>
                <p class="content-text">
                    <strong>Maximum Compression Mode:</strong> Focuses on hitting exactly 100KB by reducing both dimensions (600-800px) and quality (65-80%) more aggressively. Use when upload systems are very particular about file size limits or when you need to guarantee the image stays under 100KB across all scenarios.
                </p>

                <h3 class="content-subheading">Common Mistakes to Avoid</h3>
                <ul class="content-list">
                    <li><strong>Over-Editing Before Compression:</strong> Heavy filters, excessive sharpening, or noise reduction before compression can create artifacts - keep edits minimal and natural</li>
                    <li><strong>Compressing Already-Compressed Images:</strong> Don't repeatedly compress the same image - start with an original or high-quality source each time</li>
                    <li><strong>Ignoring Aspect Ratio:</strong> Cropping to unusual aspect ratios can make compression less efficient - standard ratios (1:1, 4:3, 16:9) work best</li>
                    <li><strong>Wrong Image Type:</strong> Don't use 100KB compression for images with transparency needs (use PNG) or very high detail requirements (consider larger sizes)</li>
                    <li><strong>Not Testing Results:</strong> Always preview the compressed image before finalizing - what looks good on desktop may reveal issues on mobile or when printed</li>
                </ul>
            </div>

            <div class="content-section">
                <h2 class="content-heading">Technical Specifications</h2>
                
                <h3 class="content-subheading">Compression Algorithm Details</h3>
                <p class="content-text">
                    Our compression system uses a multi-pass optimization approach that combines dimension scaling with quality adjustment. The algorithm works through the following process:
                </p>
                <ul class="content-list">
                    <li><strong>Initial Assessment:</strong> Analyzes original image dimensions, file size, format, and complexity to establish baseline parameters</li>
                    <li><strong>Dimension Calculation:</strong> Tests multiple dimension reduction factors (100%, 90%, 80%, 70%, 60%, 50%) to find optimal starting point</li>
                    <li><strong>Binary Search Quality:</strong> For each dimension level, performs 15-20 iterations using binary search to find precise quality setting</li>
                    <li><strong>Tolerance Check:</strong> Accepts results within 5% of target (95KB-105KB) to balance precision with processing time</li>
                    <li><strong>Best Result Selection:</strong> Compares all successful combinations and selects the one closest to 100KB with highest visual quality</li>
                </ul>

                <h3 class="content-subheading">Supported Formats & Specifications</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Feature</th>
                            <th>Specification</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Input Formats</strong></td>
                            <td>JPEG, PNG, WebP, HEIC, BMP, TIFF</td>
                        </tr>
                        <tr>
                            <td><strong>Output Format</strong></td>
                            <td>JPEG (optimized, progressive encoding)</td>
                        </tr>
                        <tr>
                            <td><strong>Maximum Input Size</strong></td>
                            <td>10MB per image</td>
                        </tr>
                        <tr>
                            <td><strong>Target Accuracy</strong></td>
                            <td>95-105KB (95%+ accuracy)</td>
                        </tr>
                        <tr>
                            <td><strong>Typical Quality Range</strong></td>
                            <td>65-90% depending on mode and content</td>
                        </tr>
                        <tr>
                            <td><strong>Dimension Range</strong></td>
                            <td>600-1200px (adaptive based on original)</td>
                        </tr>
                        <tr>
                            <td><strong>Processing Time</strong></td>
                            <td>2-8 seconds average</td>
                        </tr>
                        <tr>
                            <td><strong>Color Space</strong></td>
                            <td>RGB (sRGB color profile)</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="content-section">
                <h2 class="content-heading">Frequently Asked Questions</h2>
                
                <div style="space-y: 1.5rem;">
                    <div style="margin-bottom: 1.5rem;">
                        <h3 class="content-subheading" style="margin: 0 0 0.75rem 0; font-size: 1.125rem;">How accurate is the 100KB compression?</h3>
                        <p class="content-text" style="margin: 0;">
                            Our algorithm achieves 95-105KB accuracy in over 95% of cases, typically hitting between 98-102KB. The multi-pass optimization with binary search ensures precision while the 5% tolerance window prevents excessive processing time. Final file sizes may vary slightly based on image complexity and format-specific compression characteristics.
                        </p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h3 class="content-subheading" style="margin: 0 0 0.75rem 0; font-size: 1.125rem;">Will my 100KB image look professional enough?</h3>
                        <p class="content-text" style="margin: 0;">
                            Absolutely! 100KB is considered a premium file size that maintains excellent visual quality. For standard profile photos (800×800 to 1000×1000px), headshots, and professional imagery, 100KB provides superior quality compared to smaller sizes. You can expect sharp details, smooth skin tones, accurate colors, and minimal compression artifacts - perfect for portfolios and professional profiles.
                        </p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h3 class="content-subheading" style="margin: 0 0 0.75rem 0; font-size: 1.125rem;">What's the difference between compress and resize tools?</h3>
                        <p class="content-text" style="margin: 0;">
                            Our <strong>compress tool</strong> (this page) uses adaptive quality and dimension optimization to hit exactly 100KB while maximizing visual quality - best for most use cases. The <strong>resize tool</strong> prioritizes hitting exact file size through more aggressive dimension control, useful when systems are very strict. Compress tool typically produces better-looking results at 100KB.
                        </p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h3 class="content-subheading" style="margin: 0 0 0.75rem 0; font-size: 1.125rem;">Can I compress high-resolution DSLR photos?</h3>
                        <p class="content-text" style="margin: 0;">
                            Yes! High-resolution DSLR photos (20MP+) actually compress very well to 100KB because there's more image data to work with. The algorithm can intelligently reduce from 5000×3000px down to 900×600px while maintaining excellent perceived quality. For best results, ensure your DSLR photo is properly exposed and sharply focused.
                        </p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h3 class="content-subheading" style="margin: 0 0 0.75rem 0; font-size: 1.125rem;">Does the tool preserve image metadata (EXIF)?</h3>
                        <p class="content-text" style="margin: 0;">
                            By default, we remove EXIF metadata (camera settings, GPS location, timestamps) for privacy and to reduce file size. This helps achieve 100KB more easily while protecting your personal information. If you need to preserve metadata for specific requirements, use our resize tool which offers an EXIF preservation option.
                        </p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h3 class="content-subheading" style="margin: 0 0 0.75rem 0; font-size: 1.125rem;">How many images can I compress?</h3>
                        <p class="content-text" style="margin: 0;">
                            Unlimited! There's no daily limit, account requirement, or usage restriction. Compress as many images as you need, completely free. We process one image at a time to ensure optimal quality control and accurate 100KB targeting. Future updates will include batch processing for multiple images.
                        </p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h3 class="content-subheading" style="margin: 0 0 0.75rem 0; font-size: 1.125rem;">Is my data secure and private?</h3>
                        <p class="content-text" style="margin: 0;">
                            Your privacy is our top priority. All processing happens on secure, encrypted servers. Images are automatically deleted within 30 minutes of upload. We never store, analyze, share, or use your photos for any purpose beyond the immediate compression task. We're GDPR compliant and maintain strict data protection standards.
                        </p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h3 class="content-subheading" style="margin: 0 0 0.75rem 0; font-size: 1.125rem;">Why does Premium mode take longer?</h3>
                        <p class="content-text" style="margin: 0;">
                            Premium Quality mode performs 20 iterations (vs. 15 for balanced) and tests more dimension-quality combinations to find the absolute best result. This extra processing time (typically 3-5 seconds longer) ensures maximum visual quality at exactly 100KB. The difference is noticeable in final image quality, especially for professional portfolios.
                        </p>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h3 class="content-subheading" style="margin: 0 0 0.75rem 0; font-size: 1.125rem;">Can I use this for commercial projects?</h3>
                        <p class="content-text" style="margin: 0;">
                            Yes! Our compression tool is completely free for personal, commercial, and professional use. Compress images for client projects, business websites, marketing materials, or any commercial application without restrictions, watermarks, or attribution requirements. The compressed images are 100% yours to use as needed.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2 class="loading-title">Compressing Image</h2>
            <p class="loading-subtitle">Optimizing to 100KB...</p>
        </div>
    </div>

    <!-- Download Page -->
    <div class="download-page" id="downloadPage">
        <section class="hero-section">
            <div class="hero-content">
                <div class="hero-badge">
                    <i class="fas fa-check-circle"></i>
                    <span>Success</span>
                </div>
                <h1 class="hero-title">Compression Complete!</h1>
                <p class="hero-subtitle">Your image has been optimized to 100KB</p>
            </div>
        </section>

        <div class="download-container">
            <div class="download-card">
                <div class="download-preview-section">
                    <div class="download-image-wrapper">
                        <img id="downloadThumb" class="download-thumbnail" alt="Compressed">
                    </div>
                    <div class="download-filename" id="downloadName"></div>
                    <div class="download-size-text" id="downloadSizeText"></div>
                    <div class="stats-row">
                        <div class="stat-badge">
                            <div class="stat-value" id="statOriginal">0 KB</div>
                            <div class="stat-label">Original</div>
                        </div>
                        <div class="stat-badge">
                            <div class="stat-value" id="statFinal">0 KB</div>
                            <div class="stat-label">Compressed</div>
                        </div>
                        <div class="stat-badge">
                            <div class="stat-value" id="statReduction">0%</div>
                            <div class="stat-label">Smaller</div>
                        </div>
                    </div>
                </div>

                <div class="download-actions">
                    <button type="button" class="primary-download-btn" onclick="downloadImage()">
                        <i class="fas fa-download"></i>
                        Download Compressed Image
                    </button>

                    <div class="action-grid">
                        <button type="button" class="action-btn btn-success" onclick="compressAnother()">
                            <i class="fas fa-redo"></i>
                            Compress Another
                        </button>
                        <button type="button" class="action-btn btn-primary" onclick="window.location.href='/resize-image-to-100kb/'">
                            <i class="fas fa-ruler-combined"></i>
                            Try Resize Tool
                        </button>
                        <button type="button" class="action-btn btn-warning" onclick="window.location.href='/compress-to-50kb/'">
                            <i class="fas fa-compress"></i>
                            Compress to 50KB
                        </button>
                        <button type="button" class="action-btn btn-info" onclick="window.location.href='/resize-image-to-20kb/'">
                            <i class="fas fa-compress-arrows-alt"></i>
                            Compress to 20KB
                        </button>
                    </div>

                    <div class="privacy-card">
                        <div class="privacy-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <p class="privacy-text">
                            <strong>Your Privacy Guaranteed:</strong> This image will be automatically deleted from our servers within 30 minutes. We maintain strict data protection and never store, analyze, or share your photos.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let selectedFile = null;
let processedBlob = null;
let processedFilename = null;
let selectedQuality = 'premium';

const fileInput = document.getElementById('fileInput');
const uploadZone = document.getElementById('uploadZone');

fileInput.addEventListener('change', handleFileSelect);

uploadZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadZone.classList.add('drag-active');
});

uploadZone.addEventListener('dragleave', () => {
    uploadZone.classList.remove('drag-active');
});

uploadZone.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadZone.classList.remove('drag-active');
    const file = e.dataTransfer.files[0];
    if (file && file.type.startsWith('image/')) {
        fileInput.files = e.dataTransfer.files;
        handleFileSelect({ target: { files: [file] } });
    }
});

function handleFileSelect(e) {
    const file = e.target.files[0];
    if (!file || !file.type.startsWith('image/')) {
        alert('Please select a valid image file');
        return;
    }
    
    selectedFile = file;
    
    const reader = new FileReader();
    reader.onload = (e) => {
        const img = new Image();
        img.onload = () => {
            document.getElementById('previewThumb').src = e.target.result;
            document.getElementById('previewName').textContent = file.name;
            document.getElementById('previewSize').textContent = formatSize(file.size);
            document.getElementById('previewDimensions').textContent = `${img.width} × ${img.height}px`;
            
            document.getElementById('uploadZone').style.display = 'none';
            document.getElementById('previewSection').classList.add('active');
            document.getElementById('compressBtn').disabled = false;
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);
}

function clearFile() {
    selectedFile = null;
    fileInput.value = '';
    document.getElementById('uploadZone').style.display = 'block';
    document.getElementById('previewSection').classList.remove('active');
    document.getElementById('compressBtn').disabled = true;
}

function selectOption(element) {
    document.querySelectorAll('.option-card').forEach(card => {
        card.classList.remove('selected');
    });
    element.classList.add('selected');
    selectedQuality = element.getAttribute('data-quality');
}

function compressImage() {
    if (!selectedFile) {
        alert('Please select an image first');
        return;
    }
    
    document.getElementById('uploadPage').style.display = 'none';
    document.getElementById('loadingScreen').classList.add('active');
    
    const formData = new FormData();
    formData.append('image_file', selectedFile);
    formData.append('target_size_kb', '95');  // Target 95KB to ensure 90-99KB range
    formData.append('auto_rotate', 'on');
    formData.append('preserve_exif', 'off');
    formData.append('quality_mode', selectedQuality);
    
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    
    fetch('/compress-to-100kb/', {
        method: 'POST',
        body: formData,
        headers: { 'X-CSRFToken': csrftoken }
    })
    .then(response => {
        if (!response.ok) {
            return response.json().then(data => {
                throw new Error(data.error || 'Compression failed. Please try again.');
            }).catch(() => {
                throw new Error('Compression failed. Please try again.');
            });
        }
        
        const contentDisposition = response.headers.get('Content-Disposition');
        let filename = selectedFile.name.replace(/\.[^/.]+$/, '') + '_compressed_100kb.jpg';
        if (contentDisposition) {
            const match = contentDisposition.match(/filename="(.+)"/);
            if (match) filename = match[1];
        }
        
        const originalSize = response.headers.get('X-Original-Size');
        const compressedSize = response.headers.get('X-Compressed-Size');
        
        return response.blob().then(blob => ({ 
            blob, 
            filename,
            originalSize: parseInt(originalSize) || selectedFile.size,
            compressedSize: parseInt(compressedSize) || blob.size
        }));
    })
    .then(({ blob, filename, originalSize, compressedSize }) => {
        processedBlob = blob;
        processedFilename = filename;
        showDownloadPage(blob, filename, originalSize, compressedSize);
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error: ' + error.message);
        document.getElementById('loadingScreen').classList.remove('active');
        document.getElementById('uploadPage').style.display = 'block';
    });
}

function showDownloadPage(blob, filename, originalSize, compressedSize) {
    document.getElementById('loadingScreen').classList.remove('active');
    
    const url = URL.createObjectURL(blob);
    document.getElementById('downloadThumb').src = url;
    document.getElementById('downloadName').textContent = filename;
    document.getElementById('downloadSizeText').textContent = 'File size: ' + formatSize(blob.size);
    
    document.getElementById('statOriginal').textContent = formatSize(originalSize || selectedFile.size);
    document.getElementById('statFinal').textContent = formatSize(compressedSize || blob.size);
    
    const actualOriginal = originalSize || selectedFile.size;
    const actualCompressed = compressedSize || blob.size;
    const reduction = Math.round(((actualOriginal - actualCompressed) / actualOriginal) * 100);
    document.getElementById('statReduction').textContent = Math.max(0, reduction) + '%';
    
    document.getElementById('downloadPage').classList.add('active');
    window.history.pushState({}, '', window.location.pathname + '#download');
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function downloadImage() {
    if (!processedBlob) {
        alert('No image to download');
        return;
    }
    
    const url = URL.createObjectURL(processedBlob);
    const a = document.createElement('a');
    a.href = url;
    a.download = processedFilename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

function compressAnother() {
    clearFile();
    processedBlob = null;
    processedFilename = null;
    selectedQuality = 'premium';
    
    document.querySelectorAll('.option-card').forEach(card => {
        card.classList.remove('selected');
    });
    document.querySelector('[data-quality="premium"]').classList.add('selected');
    
    document.getElementById('downloadPage').classList.remove('active');
    document.getElementById('uploadPage').style.display = 'block';
    window.history.pushState({}, '', window.location.pathname);
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function formatSize(bytes) {
    if (!bytes || bytes < 0) return '0 B';
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
    return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
}

window.addEventListener('popstate', () => {
    if (window.location.hash.includes('download')) {
        if (processedBlob) {
            document.getElementById('uploadPage').style.display = 'none';
            document.getElementById('downloadPage').classList.add('active');
        }
    } else {
        document.getElementById('downloadPage').classList.remove('active');
        document.getElementById('uploadPage').style.display = 'block';
    }
});
</script>
{% endblock %}